# MULTI VPN бот для Telegram
## **Инструкция по установке и настройке** ##

## Арендуйте сервера

### Выбирать сервер VPS для бота и VPN нужно по следующим параметрам:

1. Объем HDD, если вы планируете ставить на сервер не только VPN но и бота
тогда нужно взять сервер у которого есть 20 ГБ HDD
2. Локация сервера, от этого напрямую зависит скорость vpn чем ближе сервер к 
конечному пользователю тем быстрее у него интернет. Хорошим выбором будет 
Амстердам, Турция, и другие страны Европы
3. Пропускная способность сервера(скорость интернета сервера), от этого параметра
зависит сколько человек сможет вместить сервер(если пропускная способность 200мб\с
то на сервер поместится примерно 100-120 человек)
4. OS сервера должна быть Ubuntu 22
5. Процессор и оперативная память влияют не сильно и для серверов на которых
будет только VPN их смело можно оставлять самыми минимальными. Для сервера на
котором будет бот нужно 1Гб оперативной памяти

**Могу предложить вот таки варианты:**

https://ps.profitserver.pro/ - 330р

https://justhost.ru/ - 500р

## Подключение к серверу

После аренды вам дадут IP сервера и пароль от него

Используйте любую программу для подключения через ssh, 
рекомендую MobaXterm (https://mobaxterm.mobatek.net/download.html)

Если у вас Linux или Mac тогда используйте WindTerm
(https://github.com/kingToolbox/WindTerm/releases/tag/2.6.0)
пролистайте в самый низ и скачайте программу под нужную вам платформу


**После установки(WindTerm):**

  1. Нажмите Сессия
  2. Новая сессия
  3. Выберете SSH
  4. В графу "Хозяин(H)" впишите IP адрес сервера
  5. Нажимайте внизу соединить
  6. В окне Авторизации переходите на вкладку Account
  7. В графу пользователь пишите root
  8. В графу пароль вписывайте пароль

**После установки(MobaXterm):**

  1. Нажмите Session
  2. Выберете SSH
  3. В графе Remote host введите ip адрес 
  4. Нажимайте ОК 
  5. В главном меню выбирайте ваш сервер и начнется подключение
  6. Вас попросят ввести logi, вводите root  
  7. Введите пароль(обычно приходит в письме вместе с ip адресом). 
     Не пугайтесь если не будите видеть что вводите, на самом деле все вводится 
     просто скрыто, такая система защиты от любопытных глаз.


## Установка бота на сервере

Копируйте и вставляйте в командную строку команды:

1. Обновляем все стандартные пакеты

        sudo apt update && sudo apt upgrade -y && sudo apt install curl && apt-get install gettext

2. Устанавливаем Docker

        curl -fSL https://get.docker.com -o get-docker.sh && sudo sh ./get-docker.sh && sudo apt install docker-compose-plugin

3. переносим на сервер папку VPNHubBot из архива
4. Переходим в папку

       cd VPNHubBot

5. Откройте файл .env и заполните все поля 
    ````
    NAME= Название вашего бота
    LANGUAGES= ru или en- Язык бота который будет установлен по умолчанию
    ADMIN_TG_ID= ваш ID в телеграме получить нужно здесь -> https://t.me/userinfobot
    MONTH_COST=150,390,800 - цена в рублях за 1,3,6 месяцев подписки
    DEPOSIT=150,390,800 - суммы на которые пользователи могут пополнить баланс
    TRIAL_PERIOD= пробный период, указывается в секундах
    UTC_TIME= временной пояс, по умолчанию стоит московское время
    MAX_PEOPLE_SERVER= максимальное количество человек на сервере
    LIMIT_GB= максимальное количество устройств на котором пользователь сможет импользовать ключ(0 - без лимита)
    limit_GB= максимальное количество ГБ для пользователя(0 - без лимита)
    TG_TOKEN= Токен бота нужно получить у BotFather https://t.me/BotFather
    TOKEN_STARS= off - Удалите off если хотите включить Telegram Stars
    YOOMONEY_TOKEN= Токен Юмани что бы его получить нужно 
            1) зарегистрировать https://yoomoney.ru/myservices/new приложение",
               в ссылках указывайте бота, галочку внизу НЕ СТАВИТЬ!
            2) получить токен выполнив скрипт на этой странице
               https://colab.research.google.com/drive/1QtFtyttF_kq67DUxLjhstE08CaUWQ_RG?usp=sharing
    YOOMONEY_WALLET= Номер кошелька Юмани
    LAVA_TOKEN_SECRET= Получить секретный токен вы можете здесь https://business.lava.ru/ зарегестрируйте проект
    LAVA_ID_PROJECT= В ссылках указывайте адрес бота, когда проект создан напишите в этот бот с
            с просьбой отправить бота на модерацию https://t.me/lava_support_bot
    YOOKASSA_SHOP_ID= Зарегестрируйте в ЮКассе и создайте там приложение
    YOOKASSA_SECRET_KEY= Берется там же где и shop id
    CRYPTOMUS_KEY=  Зарегестрируйтесь и создайте приложение здесь https://app.cryptomus.com/dashboard/business/ Payment API key
    CRYPTOMUS_UUID= Появится после создания приложения Merchant ID
    CRYPTO_BOT_API= Перейдите в https://t.me/CryptoBot В главном меню выберете CryptoPay -> Создать приложение. После создания вам нужен API-токен
    REFERRAL_DAY= Количество дней которое дается пользователю за человека который перешёл по реф. ссылке
    REFERRAL_PERCENT= Процент от суммы который получает пользователь если его реферал пополняет баланс 
    MINIMUM_WITHDRAWAL_AMOUNT= Минимальная сумма вывода
   
    #DataBase
    POSTGRES_DB=VPNHubBotDB - Название базы данных, можете не менять
    POSTGRES_USER= Имя пользователя для достпука к БД (НЕ ИСПОЛЬЗУЙТЕ СПЕЦСИМВОЛЫ)
    POSTGRES_PASSWORD= Пароль для доступа к БД (НЕ ИСПОЛЬЗУЙТЕ СПЕЦСИМВОЛЫ)
    PGADMIN_DEFAULT_EMAIL= Email для входя в панель управления БД (НЕ ИСПОЛЬЗУЙТЕ СПЕЦСИМВОЛЫ)
    PGADMIN_DEFAULT_PASSWORD= Пароль для входа в панель управления БД (НЕ ИСПОЛЬЗУЙТЕ СПЕЦСИМВОЛЫ)
    IMPORT_DB=0 Поставьте 1 если хотите перенести БД из старого бота в новый
    БД длолжна лежать в папке bot/database/importBD

6. Перейдите в BotFather и выберите /mybots, вашего бота. 
7. Перейдите в Edit Bot - здесь вы можете задать картинки и описания для бота
8. Запускаем бота(если вы будете запускать не из папки с ботом то получите ошибку)

        sudo docker compose up -d

Если вы хотите остановить используйте 
        
       sudo docker compose down

9. Для того что перейти в админ панель бота вы должны зайти в бота и нажать 
кнопку в главном меню(бывает она не влезает попробуйте проскролить клавиатуру)


## Редактирование текста

1. Перейти в папку с ботом

       cd VPNHubBot

2. Остановить бота

       sudo docker compose down

3. Перейти в папку locale, в этой папке есть ru en и подобные, в этих папках 
лежат файлы перевода под названием bot.po в них вы и должны изменять текст

4. После внесения изменений в файлы с текстом вы должны применить изменения:

       sh compile_translations.sh

5. Обновить образы для запуска контейнера

        sudo docker compose build

6. Запускаем бота

       sudo docker compose up -d

Для любого изменения в файлах необходимо повторять этот алгоритм!


## Установка VPN VLESS на сервер

**Внимание!** 

**У VLESS VPN есть широкий спектр настроек,**
**бот настроен на работу VLess + Reality**
Инструкция по установке Vless + Reality
Если вам нужны картинки можете воспользоваться этой статьёй https://clck.ru/36gPZJ
1. Выполните если устанавливаете на новый сервер

       apt update && apt install curl -y

2. Установка панели XU-I

       bash <(curl -Ls https://raw.githubusercontent.com/mhsanaei/3x-ui/master/install.sh)

3. Отвечаем на вопросы, которые спрашивает нас скрипт
    ````
   Do you want to continue with the modification [y/n]? :y - впишите y
    Please set up your username:admin1 - впишите логин для администратора
    Your username will be:admin1 
    Please set up your password:admin1234 - впишите пароль для администратора
    Your password will be:admin1234 
    Please set up the panel port:5555 - впишите порт, это могут быть любые 4 числа
    Your panel port is:555
   Please set up the web base path - просто нажмите Enter 
4. Заходим в наш веб интерфейс. в строке браузера пишем:

       http://vps_ip:5555/

    *5555 это порт который мы писали при установке.
    *vps_ip это ваш IP адрес сервера
5. Заходите в **Подключения**
6. Нажимайте **Добавить подключение**
    ````
    Отметить протокол Reality - поставить галку
    Нажать GET NEW KEY - внизу слева
    Нажать Создать

В результате будет создано подключение с одним обязательным пользователем,
вы можете изменить его имя на admin

## Установка ShadowSocks на сервер
Если вы до этого устанавливали Vless переходите к шагу №5

1. Выполните если устанавливаете на новый сервер

       apt update && apt install curl -y

2. Установка панели XU-I

       bash <(curl -Ls https://raw.githubusercontent.com/mhsanaei/3x-ui/master/install.sh)

3. Отвечаем на вопросы, которые спрашивает нас скрипт
    ````
   Do you want to continue with the modification [y/n]? :y - впишите y
    Please set up your username:admin1 - впишите логин для администратора
    Your username will be:admin1 
    Please set up your password:admin1234 - впишите пароль для администратора
    Your password will be:admin1234 
    Please set up the panel port:5555 - впишите порт, это могут быть любые 4 числа, кроме 5050
    Your panel port is:555
   Please set up the web base path - просто нажмите Enter 
4. Заходим в наш веб интерфейс. в строке браузера пишем:

       http://vps_ip:5555/

    *5555 это порт который мы писали при установке.
    *vps_ip это ваш IP адрес сервера
5. Заходите в **Подключения**
6. Нажимайте **Добавить подключение**
    ````
    Протокол выбираейте shadowsocks
    Создать
   
В результате будет создано подключение с одним обязательным пользователем,
вы можете изменить его имя на admin


## Установка Outline на сервер

1. Выполните если устанавливаете на новый сервер

       apt update && apt install curl -y

2. Установка outline

       sudo wget -qO- https://raw.githubusercontent.com/Jigsaw-Code/outline-server/master/src/server_manager/install_scripts/install_server.sh | bash

При необходимости можно установить Docker отдельно до ввода 2 команды

        sudo curl https://get.docker.com | sh

Когда скрипт закончит работу выведет вот такой текст:
```
{ 
  "apiUrl": "https://0.0.0.0:0000/XXXXXXXXXXXX", 
  "certSha256": "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX" 
}
```
Обязательно сохраните его к себе на компьютер, 
эти данные понадобятся боту в пункте 6.

## Добавление сервера в бот

1. Переходите в `Сервера` --> `Добавить сервер`
2. Введите любое имя, главное, что бы оно было уникальным(используйте смайлы) 
3. Введите адрес вашего сервера **БЕЗ HTTP://** только ip адрес и порт как в примере у бота
4. Введите пароль от VDS можете ввсети любое занчение бот никак не использует этот пароль
5. Выберете тип VPN
6. Если вы выбрали Otline введите данные которые сохраняли при установке Outline
   (копируйте и вставляйте прямо вместе со скобками)
7. Если выбрали Vless или ShadowSoks следуйте инструкции дальше
8. Тип подключения выбирайте HTTP
9. Панель управления выбирайте Sanae
10. ID подключения можно посмотреть в панели управления,
перейдите в `Подключения` справа от кнопки с + будет номер, это и есть ID подключения
11. Введите логин который вы использовали для входа в панель управления
12. Введите пароль который вы использовали для входа в панель управления
Если вы подключаете сервер на котором раньше были клиенты, то нужно удалить старые подключения клиентов 

## Веб панель управления БД
## ВНИМАНИЕ ВСЕ ДЕЙСТВИЯ В ВЕБ ПАНЕЛИ ВЫ ДЕЛАЙТЕ НА СВОЙ СТРАХ И РИСК 
## ЕСЛИ ВЫ НЕ ЗНАЕТЕ ЧТО, ДЕЛАЕТЕ, ТО ЛУЧШЕ НЕ СТОИТ

1. Перейдите по адресу 

       http://vps_ip:5050/ (vps_ip - это ip адрес на котором установлен бот)

2. Введите email и пароль который вы указывали в .env файле в параметрах и поставьте Русский язык

       PGADMIN_DEFAULT_EMAIL и PGADMIN_DEFAULT_PASSWORD

3. Нажмите добавить новый сервер
4. В поле Имя впишите admin
5. Перейдите на вкладку Соединение
6. В поле "Имя/адрес сервера" впишите
   
       db_postgres

7. В поле "Порт" должно быть 5432
8. В поле "Служебная база данных" впишите значение из .env **POSTGRES_DB**
9. В поле "Имя пользователя" впишите значение из .env **POSTGRES_USER**
10. В поле "Пароль" впишите значение из .env **POSTGRES_PASSWORD**


# Все! Бот установлен, VPN добавлен, теперь вы можете пользоваться ботом
